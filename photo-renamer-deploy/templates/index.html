{% extends "base.html" %}

{% block title %}Upload Photos - Photo Renamer{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <!-- Upload Mode Selector -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="uploadMode" id="manualMode" value="manual" checked>
                            <label class="form-check-label fw-bold" for="manualMode">
                                <i data-feather="edit-3" class="me-2"></i>Manual Upload
                            </label>
                            <p class="text-muted small mb-0">Upload photos group by group and set location names manually</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="uploadMode" id="batchMode" value="batch">
                            <label class="form-check-label fw-bold" for="batchMode">
                                <i data-feather="folder" class="me-2"></i>Batch Folder Upload
                            </label>
                            <p class="text-muted small mb-0">Drag entire folder structure - subfolders become location names</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Batch Folder Upload Area -->
        <div class="card mb-4" id="batchUploadCard" style="display: none;">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0">
                    <i data-feather="upload-cloud" class="me-2"></i>
                    Batch Folder Upload
                </h3>
                <p class="mb-0 mt-2">Drag your main folder here - each subfolder will become a location</p>
            </div>
            <div class="card-body">
                <div id="batchDropZone" class="batch-drop-zone text-center p-5 border-2 border-dashed border-success rounded">
                    <i data-feather="folder-plus" class="display-1 text-success mb-3"></i>
                    <h4 class="text-success">Drop Your Main Photo Folder Here</h4>
                    <p class="text-muted">
                        The app will automatically create groups for each subfolder<br>
                        Example: Photos/Vacation/Beach â†’ Location: "Beach"
                    </p>
                    <input type="file" id="batchFolderInput" webkitdirectory multiple style="display: none;">
                    <button type="button" class="btn btn-success" onclick="document.getElementById('batchFolderInput').click()">
                        <i data-feather="folder" class="me-2"></i>Browse for Folder
                    </button>
                </div>
                <div id="batchPreview" class="mt-4" style="display: none;">
                    <h5>Detected Locations:</h5>
                    <div id="batchLocationsList" class="row"></div>
                </div>
            </div>
        </div>

        <!-- Manual Upload Card -->
        <div class="card" id="manualUploadCard">
            <div class="card-header">
                <h2 class="card-title mb-0">
                    <i data-feather="upload" class="me-2"></i>
                    Upload Photos for Renaming
                </h2>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Upload multiple photo groups from different locations in a single batch. Each group will be processed with its location name and all photos will be sorted chronologically in one ZIP file. Photos are renamed in the format: <code>YYYY.MM.DD Location 001.ext</code>
                </p>

                <form method="POST" enctype="multipart/form-data" id="uploadForm">
                    <div id="photoGroups">
                        <div class="photo-group card mb-3" data-group="0">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i data-feather="folder" class="me-2"></i>
                                    Photo Group 1
                                </h6>
                                <button type="button" class="btn btn-sm btn-outline-danger remove-group" style="display: none;">
                                    <i data-feather="trash-2" class="me-1"></i>
                                    Remove
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">
                                        <i data-feather="map-pin" class="me-1"></i>
                                        Location Name
                                    </label>
                                    <input type="text" 
                                           class="form-control location-input" 
                                           name="locations[]" 
                                           placeholder="e.g., Site A, Vacation 2024, Wedding Photos" 
                                           required
                                           title="Letters, numbers, spaces, hyphens, and underscores are allowed">
                                    <div class="form-text">This will be used in the renamed filename. Letters, numbers, spaces, hyphens, and underscores are allowed.</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">
                                        <i data-feather="image" class="me-1"></i>
                                        Select Photos for this Location
                                    </label>
                                    <input type="file" 
                                           class="form-control photos-input" 
                                           name="photos_0" 
                                           multiple 
                                           accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff,.webp"
                                           required>
                                    <div class="form-text">
                                        Select multiple photos for this location (JPEG, PNG, GIF, BMP, TIFF, WebP). Maximum file size: 16MB per file.
                                    </div>
                                </div>

                                <div class="file-preview" style="display: none;">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0">Selected Files:</h6>
                                        <button type="button" class="btn btn-sm btn-outline-primary add-more-photos">
                                            <i data-feather="plus" class="me-1"></i>
                                            Add More Photos
                                        </button>
                                    </div>
                                    <div class="file-list"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <button type="button" class="btn btn-outline-primary" id="addGroupBtn">
                            <i data-feather="plus" class="me-2"></i>
                            Add Another Location Group
                        </button>
                    </div>

                    <!-- Batch size information -->
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i data-feather="info" class="me-1"></i>
                                Total batch size: <span id="totalBatchSize">0 MB</span>
                            </small>
                            <small class="text-muted">
                                Maximum: 1024 MB
                            </small>
                        </div>
                        <div class="progress mt-1" style="height: 4px;">
                            <div class="progress-bar" id="batchSizeProgress" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Progress indicator (hidden initially) -->
                    <div id="progressContainer" class="mb-4" style="display: none;">
                        <div class="card border-primary">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i data-feather="clock" class="me-2"></i>
                                    Processing Photos...
                                </h6>
                                <div class="progress mb-2">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                         id="processProgress" 
                                         role="progressbar" 
                                         style="width: 0%"></div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small id="progressText" class="text-muted">Initializing...</small>
                                    <small id="progressCounter" class="text-muted">0 / 0</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <i data-feather="download" class="me-2"></i>
                            Process & Download Renamed Photos
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h4 class="card-title mb-0">
                    <i data-feather="info" class="me-2"></i>
                    How It Works
                </h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i data-feather="clock" class="me-2"></i>EXIF Date Extraction</h6>
                        <p class="text-muted small">
                            The app reads the "Date Taken" information from your photo's EXIF data to determine the chronological order.
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6><i data-feather="trending-up" class="me-2"></i>Automatic Sorting</h6>
                        <p class="text-muted small">
                            Photos are automatically sorted by date taken and numbered sequentially (001, 002, 003, etc.).
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6><i data-feather="file-text" class="me-2"></i>Standardized Naming</h6>
                        <p class="text-muted small">
                            All photos are renamed to: <code>YYYY.MM.DD Location 001.ext</code> format for easy organization.
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6><i data-feather="download-cloud" class="me-2"></i>ZIP Download</h6>
                        <p class="text-muted small">
                            All renamed photos are packaged into a single ZIP file for convenient download.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="alert alert-info mt-4">
            <i data-feather="shield" class="me-2"></i>
            <strong>Privacy Notice:</strong> Your photos are processed temporarily on the server and automatically deleted after the ZIP file is created. No photos are permanently stored.
        </div>
    </div>
</div>
{% endblock %}
